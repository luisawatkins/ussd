# USSD Menu Flow Documentation

This document details all USSD menu screens and navigation paths for the RSK DeFi system.

## Menu Navigation Diagram

```
*384*123#
    │
    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          MAIN MENU                                       │
│                                                                          │
│   Registered Users:              │    Unregistered Users:                │
│   ─────────────────              │    ────────────────────               │
│   1. Check Balance               │    1. Register Now                    │
│   2. Send Money                  │    0. Exit                            │
│   3. Request Loan                │                                       │
│   4. Repay Loan                  │                                       │
│   5. Transaction History         │                                       │
│   6. My Account                  │                                       │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
    │
    ├──[1]──────────────────────────────────────────────────────────────────┐
    │                                                                        │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │                     CHECK BALANCE                                │  │
    │  │                                                                  │  │
    │  │  Your Balance:                                                   │  │
    │  │  0.05432100 RBTC                                                 │  │
    │  │                                                                  │  │
    │  │  (≈ $1,629.63 USD)                                               │  │
    │  │                                                                  │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │  [END - Session terminates]                                           │
    │                                                                        │
    ├──[2]──────────────────────────────────────────────────────────────────┐
    │                                                                        │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │                      SEND MONEY                                  │  │
    │  │                                                                  │  │
    │  │  Enter recipient phone number:                                   │  │
    │  │  (e.g., +254712345678)                                           │  │
    │  │                                                                  │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [+254722222222]                                                │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │  Enter amount to send (RBTC):                                    │  │
    │  │  (e.g., 0.001)                                                   │  │
    │  │                                                                  │  │
    │  │  Your balance: 0.05432100 RBTC                                   │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [0.01]                                                         │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │  Confirm Transfer:                                               │  │
    │  │                                                                  │  │
    │  │  To: +254722222222                                               │  │
    │  │  Amount: 0.01 RBTC                                               │  │
    │  │  Fee: 0.000050 RBTC                                              │  │
    │  │  Total: 0.010050 RBTC                                            │  │
    │  │                                                                  │  │
    │  │  1. Confirm                                                      │  │
    │  │  2. Cancel                                                       │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [1]                                                            │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │  Enter your 4-digit PIN:                                         │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [1234]                                                         │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │  Transfer Successful!                                            │  │
    │  │                                                                  │  │
    │  │  Amount: 0.01 RBTC                                               │  │
    │  │  To: +254722222222                                               │  │
    │  │  Fee: 0.000050 RBTC                                              │  │
    │  │                                                                  │  │
    │  │  Tx: 0x7f3d2a8b...                                               │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │  [END]                                                                │
    │                                                                        │
    ├──[3]──────────────────────────────────────────────────────────────────┐
    │                                                                        │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │                     REQUEST LOAN                                 │  │
    │  │                                                                  │  │
    │  │  Enter loan amount (RBTC):                                       │  │
    │  │  Min: 0.001 RBTC                                                 │  │
    │  │  Max: 0.1 RBTC                                                   │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [0.05]                                                         │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │  Select loan duration:                                           │  │
    │  │                                                                  │  │
    │  │  1. 7 days                                                       │  │
    │  │  2. 14 days                                                      │  │
    │  │  3. 30 days                                                      │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [2]                                                            │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │  Loan Terms:                                                     │  │
    │  │                                                                  │  │
    │  │  Amount: 0.05 RBTC                                               │  │
    │  │  Duration: 14 days                                               │  │
    │  │  Interest: 0.000287 RBTC                                         │  │
    │  │  Total Due: 0.050287 RBTC                                        │  │
    │  │  Collateral: 0.075 RBTC                                          │  │
    │  │                                                                  │  │
    │  │  1. Accept & Continue                                            │  │
    │  │  2. Cancel                                                       │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [1] → [PIN] → SUCCESS                                         │
    │                                                                        │
    ├──[4]──────────────────────────────────────────────────────────────────┐
    │                                                                        │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │                      REPAY LOAN                                  │  │
    │  │                                                                  │  │
    │  │  Active Loan:                                                    │  │
    │  │  Principal: 0.05 RBTC                                            │  │
    │  │  Total Due: 0.050287 RBTC                                        │  │
    │  │  Remaining: 0.050287 RBTC                                        │  │
    │  │  Due Date: 15/01/2024                                            │  │
    │  │                                                                  │  │
    │  │  1. Repay Full Amount                                            │  │
    │  │  2. Cancel                                                       │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │      │                                                                 │
    │      ▼ [1] → [PIN] → SUCCESS                                         │
    │                                                                        │
    ├──[5]──────────────────────────────────────────────────────────────────┐
    │                                                                        │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │                   TRANSACTION HISTORY                            │  │
    │  │                                                                  │  │
    │  │  Recent Transactions:                                            │  │
    │  │                                                                  │  │
    │  │  1. SENT 0.01 RBTC (05/01/24)                                    │  │
    │  │  2. RECV 0.025 RBTC (04/01/24)                                   │  │
    │  │  3. SENT 0.005 RBTC (03/01/24)                                   │  │
    │  │  4. RECV 0.1 RBTC (02/01/24)                                     │  │
    │  │  5. SENT 0.002 RBTC (01/01/24)                                   │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    │  [END]                                                                │
    │                                                                        │
    └──[6]──────────────────────────────────────────────────────────────────┐
                                                                             │
       ┌─────────────────────────────────────────────────────────────────┐  │
       │                       MY ACCOUNT                                 │  │
       │                                                                  │  │
       │  Balance: 0.05432100 RBTC                                        │  │
       │  Wallet: 0x7f3d2a...8b2c                                         │  │
       │                                                                  │  │
       │  To change PIN, dial *384*123*77#                                │  │
       └─────────────────────────────────────────────────────────────────┘  │
       [END]                                                                │
                                                                             │
─────────────────────────────────────────────────────────────────────────────┘
```

## Registration Flow

```
*384*123# (New User)
    │
    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│  Welcome to RSK DeFi                                                     │
│                                                                          │
│  You are not registered.                                                 │
│                                                                          │
│  1. Register Now                                                         │
│  0. Exit                                                                 │
└─────────────────────────────────────────────────────────────────────────┘
    │
    ▼ [1]
┌─────────────────────────────────────────────────────────────────────────┐
│  Registration                                                            │
│                                                                          │
│  Create a 4-digit PIN:                                                   │
│  (This PIN secures your account)                                         │
└─────────────────────────────────────────────────────────────────────────┘
    │
    ▼ [1234]
┌─────────────────────────────────────────────────────────────────────────┐
│  Confirm your 4-digit PIN:                                               │
└─────────────────────────────────────────────────────────────────────────┘
    │
    ▼ [1234]
┌─────────────────────────────────────────────────────────────────────────┐
│  Registration Successful!                                                │
│                                                                          │
│  Your RSK DeFi account is ready.                                         │
│  Wallet: 0x9e2c1f...a4b8                                                 │
│                                                                          │
│  Dial *384*123# to access your account.                                  │
└─────────────────────────────────────────────────────────────────────────┘
[END]
```

## Error States

### Invalid Phone Number
```
┌─────────────────────────────────────────────────────────────────────────┐
│  Invalid phone number format.                                            │
│  Please try again.                                                       │
└─────────────────────────────────────────────────────────────────────────┘
[END]
```

### Recipient Not Registered
```
┌─────────────────────────────────────────────────────────────────────────┐
│  Recipient is not registered on RSK DeFi.                                │
└─────────────────────────────────────────────────────────────────────────┘
[END]
```

### Insufficient Balance
```
┌─────────────────────────────────────────────────────────────────────────┐
│  Insufficient balance.                                                   │
│                                                                          │
│  Required: 0.010050 RBTC                                                 │
│  Available: 0.005000 RBTC                                                │
└─────────────────────────────────────────────────────────────────────────┘
[END]
```

### Invalid PIN
```
┌─────────────────────────────────────────────────────────────────────────┐
│  Incorrect PIN.                                                          │
│  Transaction cancelled.                                                  │
└─────────────────────────────────────────────────────────────────────────┘
[END]
```

### Active Loan Exists
```
┌─────────────────────────────────────────────────────────────────────────┐
│  Cannot request loan:                                                    │
│  Active loan exists                                                      │
└─────────────────────────────────────────────────────────────────────────┘
[END]
```

### No Active Loan
```
┌─────────────────────────────────────────────────────────────────────────┐
│  You have no active loans.                                               │
└─────────────────────────────────────────────────────────────────────────┘
[END]
```

## USSD Response Prefixes

| Prefix | Meaning | Usage |
|--------|---------|-------|
| `CON` | Continue | Session continues, expect more input |
| `END` | End | Session terminates after this message |

## Character Limits

- **Maximum response length**: 182 characters
- **Recommended**: Keep under 160 characters
- **No special characters**: Stick to basic ASCII

## Session Timeout

- **Typical timeout**: 2-3 minutes
- **Varies by carrier**: Some may be shorter
- **Auto-cleanup**: Backend clears expired sessions

